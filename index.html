<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Adnan Ahmed">

    <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">

    <link rel="stylesheet" type="text/css" media="screen" href="css/style.css">
    <title>Adnan Ahmed - SoundCloud Waveform Generator</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a target="_blank" id="forkme_banner" href="https://github.com/Idnan/SoundCloud-Waveform-Generator">View on GitHub</a>

          <h1 id="project_title">SoundCloud Waveform Generator</h1>
          <h2 id="project_tagline"></h2>
          
          <iframe src="http://ghbtns.com/github-btn.html?user=idnan&repo=SoundCloud-Waveform-Generator&type=watch&size=large&count=true" 
          allowtransparency="true" frameborder="0" scrolling="0" width="150" height="30"></iframe>
          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      	<section id="main_content" class="inner">
        	<main>
			  	<p>The waveform like soundcloud will be generated once the file is selected.<br><i class='warn'>Only tested with MP3 and WAV so far.</i></p>
			  	<input type="file"><br><br><audio controls autoplay></audio>
			  	<form class="settings" enctype="application/json">
			    	<h3>Settings</h3>
			    	<div class="fieldset">
			      		<label for="waveform-width">Waveform width:</label>
			      		<input type="range" id="waveform-width" min="100" max="1000" value="450" step="50">
			      		<span class="value">450</span>
			    	</div>
			    	<div class="fieldset">
			      		<label for="bar-width">Waveform height:</label>
			      		<input type="range" id="waveform-height" min="10" max="100" value="65" step="5">
			      		<span class="value">65</span>
			    	</div>
			    	<div class="fieldset">
			      		<label for="bar-width">Bar width:</label>
			      		<input type="range" id="bar-width" min="1" max="8" value="3" step="1">
			      		<span class="value">3</span>
			    	</div>
			    	<div class="fieldset">
			      		<label for="bar-gap">Bar gap</label>
			      		<input type="range" id="bar-gap" min="0" max="0.7" step="0.1" value="0.2">
			      		<span class="value">0.2</span>
			    	</div>
			    	<div class="fieldset">
			      		<label for="bar-color">Bar color:</label>
			      		<input type="color" id="bar-color" value="#666666">
			    	</div>
			    	<div class="fieldset">
			      		<label for="download">Download</label>
			      		<input type="checkbox" id="download">
			    	</div>    
			    	<div class="fieldset">
			      		<button type="submit">Remake waveform</button>
			    	</div>
			  	</form>
			  	<img id="showcase" alt="Waveform Destination">
			</main>
      	</section>
    </div>

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/soundcloud-waveform.js"></script>

	<!-- Google analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-56161851-2', 'auto');
		ga('send', 'pageview');
	</script>
    <script>
      	// You are about to see some extremely horrible code that can be MUCH MUCH improved,
      	// I've knowlingly done it that way, please don't judge me based upon this ;)
      	$(document).ready(function () {       
        
	      	var showcase = document.querySelector('#showcase');
			window.curFile = null;

			document.querySelector('input[type="file"]').addEventListener('change', function(e) {
			    showcase.src = '';
			    document.querySelector('audio').src = URL.createObjectURL(e.target.files[0]);
			    window.curFile = e.target.files[0];
			    generateWaveform();
			}, false);

			function updateRange(e) {
			  e.target.querySelector('#' + e.target.id + ' ~ .value').innerHTML = e.target.value;
			}

			function generateWaveform(e) {
			  	if (e) {
			    	e.preventDefault();
			  	}
			  	var waveform_width = parseInt(document.querySelector('#waveform-width').value);
			  	var waveform_height = parseInt(document.querySelector('#waveform-height').value);
			  	var bar_width = parseInt(document.querySelector('#bar-width').value);
			  	var bar_gap = parseFloat(document.querySelector('#bar-gap').value);
			  	var bar_color = document.querySelector('#bar-color').value;  
			  	var download = document.querySelector('#download').checked;  
			  	if (document.querySelector('audio').src === '' || window.curFile === null) {
			    	alert('No audio');
			    	return;
			  	}
			  	showcase.setAttribute('alt', 'Loading waveform...'); 
			  	SoundCloudWaveform.generate(window.curFile, {
			  			canvas_width: waveform_width,
						canvas_height: waveform_height,
						bar_width: bar_width,
						bar_gap : bar_gap,
						wave_color: bar_color,
						download: download,
						onComplete: function(png, pixels) {
				    		document.querySelector('#showcase').src = png;
				    	}
			  		}
			  	);
			}

			// Range change
			var ranges = document.querySelectorAll('input[type="range"]');
			for (var i = 0; i < ranges.length; i++) {
			  	var range = ranges[i];
			  	range.addEventListener('change', updateRange, false);
			}
			document.querySelector('form').addEventListener('submit', generateWaveform, false);
      	});
    </script>
  </body>
</html>
